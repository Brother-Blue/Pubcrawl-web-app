<template>
    <div>
      <b-card
      class="border border-warning bg-dark text-warning text-left login-container"
      title="Login"
      >
      <hr class="bg-secondary"><br>
        <b-form-group
            class="text-light"
            id="fieldset-1"
            label="Enter username"
            label-for="username"
            >
            <b-form-input
            id="username"
            v-model="username"
            type="text"
            :state="usernameState"
            :formatter="usernameFormatter"
            trim
            ></b-form-input>

            <b-form-invalid-feedback id="input-live-feedback">
              Usernames must be between 4-15 characters
            </b-form-invalid-feedback>
        </b-form-group>
            <b-form-group
            class="text-light"
            id="fieldset-1"
            label="Enter password"
            label-for="password"
            >
        <b-form-input
        id="password"
        v-model="password"
        type="password"
        :state="passwordState"
        trim
        ></b-form-input>
        <b-form-invalid-feedback id="input-live-feedback">
          Passwords must be between 6-128 characters
        </b-form-invalid-feedback>

        </b-form-group>
        <p class="text-light">New user? <router-link to="/register" class="text-warning">Register here</router-link> </p>
        <b-button class="btn" variant="outline-warning" @click=loginUser :disabled="!validRegister">Login</b-button>
      </b-card>
    </div>
</template>

<script>
import { Api } from '@/Api'

export default {
  name: 'login-form',
  data() {
    return {
      username: '',
      password: ''
    }
  },
  computed: {
    usernameState() {
      return this.username.length >= 4 && this.username.length <= 15
    },
    passwordState() {
      return this.password.length >= 6 && this.password.length <= 128
    },
    validRegister() {
      return this.username.length >= 4 && this.username.length <= 15 && this.password.length >= 6 && this.password.length <= 128
    }
  },
  methods: {
    loginUser() {
      const params = {
        username: this.username,
        password: this.password
      }
      Api.post('/login', params, { useCredentials: true })
        .then(response => {
          console.log('Success!')
        }).catch(error => {
          if (error.response.status === 404) {
            this.sendToast('Uh oh!', false, 'Something went wrong logging you in. Please try again later.')
          } else if (error.response.status === 401) {
            this.sendToast('Uh oh!', false, 'Invalid username or password.')
          }
          console.log(error.response)
        })
    },
    usernameFormatter(value) {
      return value.toLowerCase()
    },
    sendToast(title, append = false, message) {
      this.$bvToast.toast(message, {
        title: title,
        toaster: 'b-toaster-top-center',
        solid: true,
        appendToast: append
      })
    }
  }
}
</script>

<style scoped>
.login-container {
  max-width: 50%;
  margin: 75px auto;
  box-shadow: 5px 5px 5px 3px black;
}

.btn {
  width: 25%;
  float: right;
}
</style>
